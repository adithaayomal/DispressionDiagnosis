<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Tasks - Stress</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        body {
            background: url('/static/images/cover.jpg') no-repeat center center fixed;
            background-size: cover;
        }
        .tasks-container {
            width: 500px;
            height: 700px;
            margin-left: 200px;
            background: rgba(255,255,255,0.93);
            border-radius: 32px;
            box-shadow: 0 2px 18px rgba(0,0,0,0.13);
            padding: 2.5rem 2.5rem 2rem 2.5rem;
            text-align: center;
            align-items: flex-start;
            position: relative;
        }
        .tasks-container h2 {
            color: #E2BDA7;
            margin-bottom: 1.5rem;
            font-size: 2rem;
            font-weight: 700;
            letter-spacing: 1px;
        }
        .back-link {
            color: #E2BDA7;
            font-weight: 500;
            text-decoration: underline;
            margin-top: 1.5rem;
            display: inline-block;
            font-size: 1.08rem;
        }
        .back-link:hover {
            color: #d1a98a;
        }
        .breathing-section {
            margin: 0 auto;
            max-width: 400px;
            display: flex;
            flex-direction: column;
            align-items: center;
            background: none !important;
            border-radius: 0;
            padding: 0;
            box-shadow: none !important;
        }
        .breathing-title {
            font-size: 1.35rem;
            font-weight: 700;
            color: #f07264;
            margin-bottom: 0.5rem;
            letter-spacing: 0.5px;
        }
        .breathing-desc {
            font-size: 1.08rem;
            color: #444;
            margin-bottom: 1.2rem;
            text-align: center;
        }
        .breathing-game {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 1.2rem;
        }
        #breathing-circle {
            background: transparent;
            margin-bottom: 1.1rem;
            border-radius: 50%;
            box-shadow: 0 4px 24px 0 rgba(240,114,100,0.13);
            transition: box-shadow 0.3s;
        }
        .breathing-instruction {
            font-size: 1.25rem;
            font-weight: 600;
            color: #f07264;
            letter-spacing: 1px;
            min-height: 1.5em;
            margin-bottom: 0.5rem;
            text-shadow: 0 1px 8px #f07264, 0 1px 2px #fff;
            transition: color 0.3s;
        }
        .next-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 1.5rem;
        }
        .next-label {
            font-size: 1.08rem;
            color: #f07264;
            font-weight: 500;
            margin-bottom: 0.7rem;
            letter-spacing: 0.5px;
        }
        .next-btn {
            margin-top: 1.5rem;
            background: linear-gradient(90deg, #f07264 60%, #E2BDA7 100%);
            color: #fff;
            font-size: 1.13rem;
            font-weight: 600;
            border: none;
            border-radius: 18px;
            padding: 0.7rem 2.2rem;
            box-shadow: 0 2px 8px rgba(240,114,100,0.10);
            cursor: pointer;
            transition: background 0.2s, transform 0.1s;
            letter-spacing: 1px;
        }
        .next-btn:hover {
            background: linear-gradient(90deg, #E2BDA7 10%, #f07264 100%);
            color: #f07264;
        }
        .task-result {
            margin-top: 1.2rem;
            font-size: 1.12rem;
            color: #333;
            text-align: center;
            font-weight: 500;
            min-height: 2.2em;
        }
        .daily-tasks-page-layout {
            display: flex;
            flex-direction: row;
            align-items: flex-start;
            justify-content: center;
            gap: 3.5rem;
            margin-top: 2.2rem;
        }
        .week-progress-vertical {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 120px;
            margin-top: 0.5rem;
            background: none;
        }
        .week-title {
            font-size: 1.13rem;
            font-weight: 700;
            color: #f07264;
            margin-bottom: 1.1rem;
            letter-spacing: 0.5px;
        }
        .week-days-vertical {
            display: flex;
            flex-direction: column;
            gap: 1.1rem;
            align-items: center;
        }
        .week-day-vertical {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.3rem;
        }
        .day-circle {
            width: 44px;
            height: 44px;
            background: #f07264;
            color: #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            font-weight: 700;
            box-shadow: 0 2px 8px rgba(240,114,100,0.13);
            margin-bottom: 0.2rem;
            border: 3px solid #f7c6b7;
        }
        .day-label {
            font-size: 1.01rem;
            color: #f07264;
            font-weight: 500;
            letter-spacing: 0.5px;
        }
        .main-tasks-content {
            flex: 1;
            min-width: 320px;
            max-width: 500px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .mindful-click-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            margin-top: 1.5rem;
        }
        .mindful-title {
            font-size: 1.35rem;
            font-weight: 700;
            color: #4A90E2;
            margin-bottom: 0.5rem;
            letter-spacing: 0.5px;
        }
        .mindful-desc {
            font-size: 1.08rem;
            color: #444;
            margin-bottom: 1.2rem;
            text-align: center;
        }
        #mindful-click-game {
            width: 260px;
            height: 260px;
            position: relative;
            margin: 0 auto;
            background: rgba(74,144,226,0.08);
            border-radius: 24px;
        }
        .fixed-complete-btn {
            position: absolute;
            left: 50%;
            bottom: 40px;
            transform: translateX(-50%);
            z-index: 10;
            width: 320px;
            max-width: 90vw;
            box-shadow: 0 2px 8px rgba(76,175,80,0.13);
            border-radius: 18px;
        }
        .ambient-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            margin-top: 1.5rem;
            position: relative;
        }
        .ambient-title {
            font-size: 1.35rem;
            font-weight: 700;
            color: #f07264;
            margin-bottom: 0.5rem;
            letter-spacing: 0.5px;
        }
        .ambient-desc {
            font-size: 1.08rem;
            color: #444;
            margin-bottom: 1.2rem;
            text-align: center;
        }
        .ambient-btns {
            display: flex;
            gap: 1.2rem;
            justify-content: center;
            margin-bottom: 1.5rem;
            margin-top: 10rem;
            width: 100px;

        }
        .ambient-btn {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: #AEE1F9;
            border: none;
            box-shadow: 0 2px 8px rgba(174,225,249,0.13);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.7rem;
            transition: background 0.2s;
        }
        .ambient-btn:hover {
            background: #E2BDA7;
        }
        #ambient-particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }
        audio#ambient-audio {
            display: none;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <span class="navbar-title">Mental Health Assistant</span>
        <div class="navbar-left">
            <div class="navbar-center">
                <a href="/" class="navbar-link">Assistant</a>
                <a href="/daily_tasks" class="navbar-link active">Daily Tasks</a>
            </div>
        </div>
        <div class="navbar-right">
            <span class="navbar-user">Welcome, {{ current_user.username }}</span>
            <a href="/logout" class="navbar-link">Logout</a>
        </div>
    </nav>
    <div class="daily-tasks-page-layout" style="gap: 0; justify-content: flex-start;">
        <aside class="week-progress-vertical" style="margin-top: 3rem; margin-left: 7rem; align-items: flex-start;">
            <div class="week-days-vertical" style="align-items: flex-start; gap: 2.1rem;">
                <div class="week-title">Complete the tasks for 7 days and you <br>should come back to the Assistant.</div>
                <div class="week-day-vertical" style="flex-direction: row; gap: 0.7rem; align-items: flex-start;"><span class="day-circle">1</span><span class="day-label"><b>Day 1</b><br> Self-Love Journal </span></div>
                <div class="week-day-vertical" style="flex-direction: row; gap: 0.7rem; align-items: flex-start;"><span class="day-circle">2</span><span class="day-label"><b>Day 2</b><br> mindful-click-game </span></div>
                <div class="week-day-vertical" style="flex-direction: row; gap: 0.7rem; align-items: flex-start;"><span class="day-circle">3</span><span class="day-label"><b>Day 3</b><br> Ambient Sound Experience </span></div>
                <div class="week-day-vertical" style="flex-direction: row; gap: 0.7rem; align-items: flex-start;"><span class="day-circle">4</span><span class="day-label"><b>Day 4</b><br> Gentle Movement for Calm </span></div>
                <div class="week-day-vertical" style="flex-direction: row; gap: 0.7rem; align-items: flex-start;"><span class="day-circle">5</span><span class="day-label"><b>Day 5</b><br> Exercise for a Better Mood </span></div>
                <div class="week-day-vertical" style="flex-direction: row; gap: 0.7rem; align-items: flex-start;"><span class="day-circle">6</span><span class="day-label"><b>Day 6</b><br> Memory Challenge </span></div>
                <div class="week-day-vertical" style="flex-direction: row; gap: 0.7rem; align-items: flex-start;"><span class="day-circle">7</span><span class="day-label"><b>Day 7</b><br> Mind Unwind â€“ Simple Puzzle Game </span></div>
            </div>
        </aside>
        <div class="tasks-container">
            <h2>Your Daily Task</h2>
            
            <main class="main-tasks-content">
                <div class="selflove-section" style="display:flex;flex-direction:column;align-items:center;justify-content:center;height:340px;">
                    <div class="selflove-title" style="font-size:1.35rem;font-weight:700;color:#f07264;margin-bottom:0.5rem;margin-top :10rem;">Bubbler Timer</div>
                    <div class="selflove-desc" style="font-size:1.08rem;color:#444;margin-bottom:0.8rem;text-align:center;max-width:340px;">This gentle animation mimics a liquid motion bubbler â€” where colorful droplets slowly fall, bounce, and swirl their way down through a clear path. Thereâ€™s no task, no goalâ€¦ just movement and calm.</div>
                    <video autoplay loop muted playsinline style="width:200px;height:auto;border-radius:14px;box-shadow:0 2px 12px rgba(31,38,135,0.10);background:#000;pointer-events:none;" tabindex="-1">
                        <source src="/static/video/Bubble.mp4" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                </div>
                <button id="complete-task-btn" class="next-btn fixed-complete-btn" style="background:#4CAF50; color:#fff;">I completed the task</button>
                <div class="next-section" style="display:none;"></div>
                <div id="task-result" class="task-result"></div>
            </main>
        </div>
    </div>
    <script>
// --- Day 7: Mind Unwind â€“ Simple Puzzle Game ---
function showDay7PuzzleTask() {
    const tasksContainer = document.querySelector('.tasks-container');
    tasksContainer.innerHTML = '';
    // Title
    const h2 = document.createElement('h2');
    h2.textContent = 'Your Daily Task';
    tasksContainer.appendChild(h2);
    // Subtitle styled like a title, but smaller
    const subtitle = document.createElement('div');
    subtitle.textContent = '1 2 3 4 5 â€“ Grounding Technique';
    subtitle.style.fontSize = '1.35rem';
    subtitle.style.fontWeight = '700';
    subtitle.style.color = '#f07264';
    subtitle.style.marginBottom = '0.5rem';
    subtitle.style.letterSpacing = '0.5px';
    tasksContainer.appendChild(subtitle);
    // Description (with goal and mental break info)
    const desc = document.createElement('div');
    desc.className = 'task-desc';
    desc.innerHTML = `<p>This is a gentle mindfulness exercise that helps you calm your mind and reconnect with the present moment using your five senses.  </p>
    <ul style="text-align: left; line-height: 1.6; margin-top: 1rem;">
        <li><b>5 â€“ Look around and name 5 things you can see</b><br>
            
        </li>
        <li style="margin-top:0.7rem;"><b>4 â€“ Listen and name 4 things you can hear</b><br>
            
        </li>
        <li style="margin-top:0.7rem;"><b>3 â€“ Touch 3 things around you</b><br>
            
        </li>
        <li style="margin-top:0.7rem;"><b>2 â€“ Notice 2 things you can smell</b><br>
            
        </li>
        <li style="margin-top:0.7rem;"><b>1 â€“ Name 1 thing you can taste</b><br>
            
        </li>
    </ul>
    
    `;
    tasksContainer.appendChild(desc);
    //1-2-3-4-5
    const journalLink = document.createElement('a');
    journalLink.href = "/self";
    journalLink.textContent = "Grounding Technique";
    journalLink.style.display = "flex";
    journalLink.style.alignItems = "center";
    journalLink.style.justifyContent = "center";
    journalLink.style.width = "220px";
    journalLink.style.minWidth = "220px";
    journalLink.style.maxWidth = "220px";
    journalLink.style.height = "220px";
    journalLink.style.minHeight = "220px";
    journalLink.style.maxHeight = "220px";
    journalLink.style.aspectRatio = "1/1";
    journalLink.style.borderRadius = "50%";
    journalLink.style.background = "linear-gradient(135deg,#FF6666,#ADD8E6)";
    journalLink.style.color = "#fff";
    journalLink.style.fontSize = "1.25rem";
    journalLink.style.fontWeight = "700";
    journalLink.style.textDecoration = "none";
    journalLink.style.boxShadow = "0 4px 24px 0 rgba(240,114,100,0.13)";
    journalLink.style.margin = "0 auto 2.2rem auto";
    journalLink.style.transition = "background 0.2s,transform 0.1s";
    journalLink.style.textAlign = "center";
    tasksContainer.appendChild(journalLink);

    // Add the complete button at the bottom, always visible (like previous tasks)
    let completeBtn = document.createElement('button');
    completeBtn.id = 'complete-task-btn';
    completeBtn.className = 'next-btn fixed-complete-btn';
    completeBtn.style.background = '#4CAF50';
    completeBtn.style.color = '#fff';
    completeBtn.textContent = 'I completed the task';
    // Add to tasksContainer so it is absolutely positioned at the bottom
    tasksContainer.appendChild(completeBtn);
    completeBtn.onclick = function() {
        // Mark Day 7 as green (completed)
        const weekDays = document.querySelectorAll('.week-day-vertical .day-circle');
        if (weekDays.length > 6) {
            const day7 = weekDays[6];
            day7.innerHTML = tickSVG;
            day7.style.background = '#4CAF50';
            day7.style.borderColor = '#388E3C';
            day7.style.display = 'flex';
            day7.style.alignItems = 'center';
            day7.style.justifyContent = 'center';
            day7.style.padding = '0';
        }
        const day7Label = document.querySelectorAll('.week-day-vertical .day-label')[6];
        if (day7Label) {
            day7Label.style.color = '#388E3C';
            day7Label.style.fontWeight = '700';
        }
        // Remove all children from tasksContainer
        while (tasksContainer.firstChild) tasksContainer.removeChild(tasksContainer.firstChild);
        // Show congratulations message, summary, and Assistant button
        const congratsDiv = document.createElement('div');
        congratsDiv.style.fontSize = '1.18rem';
        congratsDiv.style.color = '#4CAF50';
        congratsDiv.style.fontWeight = '700';
        congratsDiv.style.margin = '2.5rem 0 1.5rem 0';
        congratsDiv.textContent = 'Congratulations! You have completed the week. Please feel free to go to Assistant and answer the questions given.';
        tasksContainer.appendChild(congratsDiv);

        // Add the summary section
        const summaryDiv = document.createElement('div');
        summaryDiv.style.fontSize = '1.08rem';
        summaryDiv.style.color = '#333';
        summaryDiv.style.fontWeight = '500';
        summaryDiv.style.margin = '1.2rem 0 2.2rem 0';
        summaryDiv.style.textAlign = 'left';
        summaryDiv.innerHTML = `
            <div style="font-size:1.18rem;font-weight:700;color:#f07264;margin-bottom:0.7rem;">What This Week Gave You (For Stressed Minds)</div>
            <ul style="margin:0 0 0.7rem 1.2rem;padding:0;font-size:1.08rem;">
                <li><b>A calmer mind and better focus</b><br><span style='font-weight:400;'>Small, simple games helped you slow down and gently shift your attention away from stress.</span></li>
                <li style='margin-top:0.7rem;'><b>Easier breathing and less tension</b><br><span style='font-weight:400;'>Breathing exercises and light movement helped relax your body and ease anxious thoughts.</span></li>
                <li style='margin-top:0.7rem;'><b>A space to let thoughts out</b><br><span style='font-weight:400;'>Journaling and soft sounds gave you a quiet moment to express whatâ€™s on your mind without judgment.</span></li>
                <li style='margin-top:0.7rem;'><b>Moments of lightness and relief</b><br><span style='font-weight:400;'>Gentle, playful games like popping bubbles gave your mind a break and a small dose of joy.</span></li>
                <li style='margin-top:0.7rem;'><b>Clearer thinking through gentle challenges</b><br><span style='font-weight:400;'>Simple puzzles and memory games helped your mind stay active in a peaceful, pressure-free way.</span></li>
            </ul>
        `;
        tasksContainer.appendChild(summaryDiv);

        const assistantBtn = document.createElement('a');
        assistantBtn.href = '/';
        assistantBtn.textContent = 'Go to Assistant';
        assistantBtn.className = 'next-btn';
        assistantBtn.style.background = '#4A90E2';
        assistantBtn.style.color = '#fff';
        assistantBtn.style.fontSize = '1.13rem';
        assistantBtn.style.fontWeight = '600';
        assistantBtn.style.borderRadius = '18px';
        assistantBtn.style.padding = '0.7rem 2.2rem';
        assistantBtn.style.boxShadow = '0 2px 8px rgba(74,144,226,0.10)';
        assistantBtn.style.marginTop = '1.2rem';
        assistantBtn.style.display = 'inline-block';
        assistantBtn.style.textDecoration = 'none';
        assistantBtn.onclick = function(e) {
            // Set flag to repeat questions in Assistant
            localStorage.setItem('repeatQuestions', '1');
            // Let the link proceed as normal
        };
        tasksContainer.appendChild(assistantBtn);
    };

    

    

    function isSolved() {
        let n = 0;
        for (let r=0; r<size; r++) {
            for (let c=0; c<size; c++) {
                if (r === size-1 && c === size-1) {
                    if (board[r][c] !== null) return false;
                } else {
                    if (board[r][c] !== n) return false;
                    n++;
                }
            }
        }
        return true;
    }

    
}
// --- End Day 7 ---
    // Animated Breathing Circle Game (only run if canvas exists)
    const canvas = document.getElementById('breathing-circle');
    if (canvas) {
        const ctx = canvas.getContext('2d');
        const instruction = document.getElementById('breathing-instruction');
        let phase = 0; // 0: inhale, 1: hold, 2: exhale, 3: hold
        let t = 0;
        const phases = [
            { label: 'Inhale', color: '#E2BDA7', duration: 4000, shadow: '#f07264' },
            { label: 'Hold', color: '#f7c6b7', duration: 2000, shadow: '#f07264' },
            { label: 'Exhale', color: '#f07264', duration: 4000, shadow: '#f07264' },
            { label: 'Hold', color: '#f7c6b7', duration: 2000, shadow: '#f07264' }
        ];
        let start = null;
        function animateBreath(ts) {
            if (!start) start = ts;
            let elapsed = ts - start;
            let p = phases[phase];
            let progress = Math.min(elapsed / p.duration, 1);
            // Circle radius: 60 (min) to 120 (max)
            let radius;
            if (phase === 0) radius = 60 + 60 * easeInOut(progress); // Inhale
            else if (phase === 1) radius = 120; // Hold (full)
            else if (phase === 2) radius = 120 - 60 * easeInOut(progress); // Exhale
            else radius = 60; // Hold (empty)
            // Animate background glow
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.save();
            ctx.beginPath();
            ctx.arc(130, 130, radius + 12, 0, 2 * Math.PI);
            ctx.globalAlpha = 0.18;
            ctx.fillStyle = p.shadow;
            ctx.filter = 'blur(10px)';
            ctx.fill();
            ctx.restore();
            // Main circle
            ctx.beginPath();
            ctx.arc(130, 130, radius, 0, 2 * Math.PI);
            ctx.fillStyle = p.color;
            ctx.globalAlpha = 0.82;
            ctx.filter = 'none';
            ctx.fill();
            ctx.globalAlpha = 1.0;
            ctx.lineWidth = 5;
            ctx.strokeStyle = '#f07264';
            ctx.shadowColor = p.shadow;
            ctx.shadowBlur = 16;
            ctx.stroke();
            ctx.shadowBlur = 0;
            // Breathing dots
            for (let i = 0; i < 8; i++) {
                let angle = (i / 8) * 2 * Math.PI;
                let dotR = radius + 18 + 6 * Math.sin(ts/400 + i);
                ctx.beginPath();
                ctx.arc(130 + dotR * Math.cos(angle), 130 + dotR * Math.sin(angle), 4, 0, 2 * Math.PI);
                ctx.fillStyle = '#fff';
                ctx.globalAlpha = 0.7;
                ctx.fill();
            }
            ctx.globalAlpha = 1.0;
            instruction.textContent = p.label;
            instruction.style.color = '#f07264';
            if (elapsed < p.duration) {
                requestAnimationFrame(animateBreath);
            } else {
                phase = (phase + 1) % phases.length;
                start = null;
                requestAnimationFrame(animateBreath);
            }
        }
        function easeInOut(x) {
            return x < 0.5 ? 2 * x * x : 1 - Math.pow(-2 * x + 2, 2) / 2;
        }
        if (canvas && ctx && instruction) {
            requestAnimationFrame(animateBreath);
        }
    }
    // Add tick SVG for completed day
    const tickSVG = '<svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="11" cy="11" r="11" fill="#4CAF50"/><path d="M6 12.5L10 16L16 8" stroke="#fff" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"/></svg>';
    document.addEventListener('DOMContentLoaded', function() {
        const completeBtn = document.getElementById('complete-task-btn');
        if (completeBtn) {
            completeBtn.onclick = function() {
                // Remove/hide self-love section and button
                const selfloveSection = document.querySelector('.selflove-section');
                if (selfloveSection) selfloveSection.remove();
                completeBtn.remove();
                // Remove title if present
                const h2 = document.querySelector('.tasks-container h2');
                if (h2) h2.remove();
                // Remove subtitle if present
                const subtitle = document.getElementById('task-subtitle');
                if (subtitle) subtitle.remove();
                // Mark Day 1 as green (completed)
                const weekDays = document.querySelectorAll('.week-day-vertical .day-circle');
                if (weekDays.length > 0) {
                    const day1 = weekDays[0];
                    day1.innerHTML = tickSVG;
                    day1.style.background = '#4CAF50';
                    day1.style.borderColor = '#388E3C';
                    day1.style.display = 'flex';
                    day1.style.alignItems = 'center';
                    day1.style.justifyContent = 'center';
                    day1.style.padding = '0';
                }
                const day1Label = document.querySelectorAll('.week-day-vertical .day-label')[0];
                if (day1Label) {
                    day1Label.style.color = '#388E3C';
                    day1Label.style.fontWeight = '700';
                }
                // Load Mindful Click task
                const mainContent = document.querySelector('.main-tasks-content');
                if (mainContent) {
                    // Remove any previous Mindful Click section or h2 in mainContent
                    const oldMindful = mainContent.querySelectorAll('.mindful-click-section');
                    oldMindful.forEach(el => el.remove());
                    const oldH2 = mainContent.querySelector('h2');
                    if (oldH2) oldH2.remove();
                    // Add the title
                    const h2 = document.createElement('h2');
                    h2.textContent = 'Your Daily Task';
                    h2.className = '';
                    h2.style.color = '#E2BDA7';
                    h2.style.marginBottom = '1.5rem';
                    h2.style.fontSize = '2rem';
                    h2.style.fontWeight = '700';
                    h2.style.letterSpacing = '1px';
                    // Insert at the top of mainContent
                    mainContent.prepend(h2);
                    // Mindful Click content (title, subtitle, button only)
                    const mindfulDiv = document.createElement('div');
                    mindfulDiv.className = 'mindful-click-section';
                    mindfulDiv.innerHTML = `
                        <div class="mindful-title" style="font-size:1.35rem;font-weight:700;color:#f07264;margin-bottom:0.5rem;letter-spacing:0.5px;">Pop Spinner</div>
                        <div class="mindful-desc" style="font-size:1.08rem;color:#444;margin-bottom:1.2rem;text-align:center;">This is your time to fidget, focus, and relax.Grab the pop spinner on screen and give it a spin! <br> Thereâ€™s no score, no rush â€” just a satisfying moment of motion and sound.</div>
                        
                        <button id="complete-mindful-btn" class="next-btn fixed-complete-btn" style="background:#4CAF50; color:#fff;">I completed the task</button>
                    `;
                    // Insert after h2
                    h2.insertAdjacentElement('afterend', mindfulDiv);
                    // Add event for new complete button
                    const completeMindfulBtn = document.getElementById('complete-mindful-btn');
                    if (completeMindfulBtn) {
                        completeMindfulBtn.onclick = function() {
                            // Mark Day 2 as green (completed)
                            const weekDays = document.querySelectorAll('.week-day-vertical .day-circle');
                            if (weekDays.length > 1) {
                                const day2 = weekDays[1];
                                day2.innerHTML = tickSVG;
                                day2.style.background = '#4CAF50';
                                day2.style.borderColor = '#388E3C';
                                day2.style.display = 'flex';
                                day2.style.alignItems = 'center';
                                day2.style.justifyContent = 'center';
                                day2.style.padding = '0';
                            }
                            const day2Label = document.querySelectorAll('.week-day-vertical .day-label')[1];
                            if (day2Label) {
                                day2Label.style.color = '#388E3C';
                                day2Label.style.fontWeight = '700';
                            }
                            // Remove Mindful Click section and h2
                            mindfulDiv.remove();
                            h2.remove();
                            // Show Day 3 task
                            const mainContent = document.querySelector('.main-tasks-content');
                            if (mainContent) {
                                // Remove any previous ambient section or h2
                                const oldAmbient = mainContent.querySelectorAll('.ambient-section');
                                oldAmbient.forEach(el => el.remove());
                                const oldH2 = mainContent.querySelector('h2');
                                if (oldH2) oldH2.remove();
                                // Add the title
                                const h2 = document.createElement('h2');
                                h2.textContent = 'Your Daily Task';
                                h2.style.color = '#E2BDA7';
                                h2.style.marginBottom = '1.5rem';
                                h2.style.fontSize = '2rem';
                                h2.style.fontWeight = '700';
                                h2.style.letterSpacing = '1px';
                                mainContent.prepend(h2);
                                // Ambient Sound Experience content
                                const ambientDiv = document.createElement('div');
                                ambientDiv.className = 'ambient-section';
                                ambientDiv.innerHTML = `
                                    <div class="ambient-title">Use Scent</div>
                                    <div class="ambient-desc">Sniff lavender flowers or lavender essential oil for at least 3 minutes.</div>
                                    <div class="ambient-desc">Lavender is well-known for its calming properties.</div>
                                    <div class="ambient-desc">Keep a small bottle of lavender essential oil on hand for the scent, for when you feel anxious thoughts brewing.</div>
                                    <div class="ambient-desc">If you practice mindfulness or meditation, try smelling lavender during your practice.</div>
                                    <div class="ambient-desc">Over time, youâ€™ll associate the feeling of relaxation with that scent, making it even more effective.</div>
                                    
                                        
                                        
                                    
                                    <div id="ambient-particles"></div>
                                    <audio id="ambient-audio" loop></audio>
                                `;
                                h2.insertAdjacentElement('afterend', ambientDiv);
                                // Insert the complete button as a sibling to ambientDiv, so it is absolutely positioned at the bottom
                                const completeAmbientBtnEl = document.createElement('button');
                                completeAmbientBtnEl.id = 'complete-ambient-btn';
                                completeAmbientBtnEl.className = 'next-btn fixed-complete-btn';
                                completeAmbientBtnEl.textContent = 'I completed the task';
                                completeAmbientBtnEl.style.background = '#4CAF50';
                                completeAmbientBtnEl.style.color = '#fff';
                                ambientDiv.insertAdjacentElement('afterend', completeAmbientBtnEl);
                                // JS: handle ambient button clicks
                                const audio = ambientDiv.querySelector('#ambient-audio');
                                const particlesDiv = ambientDiv.querySelector('#ambient-particles');
                                const envs = {
                                    rain: {
                                        bg: 'linear-gradient(120deg,#AEE1F9 60%,#E2BDA7 100%)',
                                        audio: '/static/music/music1.mpeg',
                                        icon: 'â™«',
                                        particle: 'raindrop'
                                    },
                                    ocean: {
                                        bg: 'linear-gradient(120deg,#B3E5FC 60%,#E2BDA7 100%)',
                                        audio: '/static/music/music2.mpeg',
                                        icon: 'â™ª',
                                        particle: 'bubble'
                                    },
                                    forest: {
                                        bg: 'linear-gradient(120deg,#C8E6C9 60%,#E2BDA7 100%)',
                                        audio: '/static/music/music3.mpeg',
                                        icon: 'ð„ž',
                                        particle: 'leaf'
                                    },
                                    wind: {
                                        bg: 'linear-gradient(120deg,#D1C4E9 60%,#E2BDA7 100%)',
                                        audio: '/static/music/music4.mpeg',
                                        icon: 'â™«',
                                        particle: 'wind'
                                    }
                                };
                                let particleInterval;
                                ambientDiv.querySelectorAll('.ambient-btn').forEach(btn => {
                                    btn.onclick = function() {
                                        const env = btn.getAttribute('data-env');
                                        // Play audio
                                        audio.src = envs[env].audio;
                                        audio.play();
                                        // Remove old particles
                                        particlesDiv.innerHTML = '';
                                        clearInterval(particleInterval);
                                        // Add floating particles
                                        particleInterval = setInterval(() => {
                                            const p = document.createElement('span');
                                            p.style.position = 'absolute';
                                            p.style.left = Math.random()*90+5+'%';
                                            p.style.top = '-30px';
                                            p.style.fontSize = (Math.random()*1.2+1.2)+'rem';
                                            p.style.opacity = 0.7;
                                            p.textContent = envs[env].icon;
                                            particlesDiv.appendChild(p);
                                            // Animate
                                            const duration = Math.random()*2+2.5;
                                            p.animate([
                                                { transform: 'translateY(0)', opacity: 0.7 },
                                                { transform: 'translateY(600px)', opacity: 0.1 }
                                            ], { duration: duration*1000, easing: 'linear' });
                                            setTimeout(()=>p.remove(), duration*1000);
                                        }, 500);
                                    };
                                });
                                // Complete button for Day 3
                                const completeAmbientBtn = document.getElementById('complete-ambient-btn');
                                if (completeAmbientBtn) {
                                    completeAmbientBtn.onclick = function() {
                                        // Mark Day 3 as green (completed)
                                        const weekDays = document.querySelectorAll('.week-day-vertical .day-circle');
                                        if (weekDays.length > 2) {
                                            const day3 = weekDays[2];
                                            day3.innerHTML = tickSVG;
                                            day3.style.background = '#4CAF50';
                                            day3.style.borderColor = '#388E3C';
                                            day3.style.display = 'flex';
                                            day3.style.alignItems = 'center';
                                            day3.style.justifyContent = 'center';
                                            day3.style.padding = '0';
                                        }
                                        const day3Label = document.querySelectorAll('.week-day-vertical .day-label')[2];
                                        if (day3Label) {
                                            day3Label.style.color = '#388E3C';
                                            day3Label.style.fontWeight = '700';
                                        }
                                        // Remove ambient section and h2
                                        ambientDiv.remove();
                                        h2.remove();
                                        // Show Day 4 yoga task
                                        showDay4YogaTask();
                                    };
                                }
                            }
                        };
                    }
                }
            };
        }
    });

    // --- Day 4: Yoga Video â€“ Gentle Movement for Calm ---
    function showDay4YogaTask() {
        const mainContent = document.querySelector('.main-tasks-content');
        if (!mainContent) return;
        // Remove any previous yoga section or h2 in mainContent
        const oldYoga = mainContent.querySelectorAll('.yoga-section');
        oldYoga.forEach(el => el.remove());
        const oldH2 = mainContent.querySelector('h2');
        if (oldH2) oldH2.remove();
        // Remove any existing Day 4 completion button (defensive)
        const oldDay4Btns = mainContent.querySelectorAll('.day4-complete-btn, .day4-complete-btn-duplicate, .next-btn');
        oldDay4Btns.forEach(el => {
            // Only remove if it's not inside the new yogaDiv to be created below
            if (!el.closest('.yoga-section')) el.remove();
        });
        // Add the title
        const h2 = document.createElement('h2');
        h2.textContent = 'Your Daily Task';
        h2.className = '';
        h2.style.color = '#E2BDA7';
        h2.style.marginBottom = '1.5rem';
        h2.style.fontSize = '2rem';
        h2.style.fontWeight = '700';
        h2.style.letterSpacing = '1px';
        mainContent.prepend(h2);
        // Yoga section
        const yogaDiv = document.createElement('div');
        yogaDiv.className = 'yoga-section';
        yogaDiv.style.display = 'flex';
        yogaDiv.style.flexDirection = 'column';
        yogaDiv.style.alignItems = 'center';
        yogaDiv.style.background = 'none';
        yogaDiv.style.borderRadius = '0';
        yogaDiv.style.boxShadow = 'none';
        yogaDiv.style.padding = '0';
        yogaDiv.style.maxWidth = '420px';
        yogaDiv.style.marginLeft = 'auto';
        yogaDiv.style.marginRight = 'auto';
        yogaDiv.style.marginTop = '2.5rem';
        // Title
        const yogaTitle = document.createElement('div');
        yogaTitle.className = 'yoga-title';
        yogaTitle.textContent = 'Drink water';
        yogaTitle.style.color = '#f07264';
        yogaTitle.style.fontSize = '1.35rem';
        yogaTitle.style.fontWeight = '700';
        yogaTitle.style.marginBottom = '0.5rem';
        yogaTitle.style.letterSpacing = '0.5px';
        yogaDiv.appendChild(yogaTitle);
        // Description
        const yogaDesc = document.createElement('div');
        yogaDesc.className = 'yoga-desc';
        yogaDesc.innerHTML = `Keep your body and mind refreshed by drinking water throughout the day.`;
        yogaDesc.style.color = '#333';
        yogaDesc.style.fontSize = '1.08rem';
        yogaDesc.style.marginBottom = '1.2rem';
        yogaDesc.style.textAlign = 'center';
        yogaDiv.appendChild(yogaDesc);
        
        const yogaImg = document.createElement('img');
        yogaImg.src = '/static/images/water.png';
        yogaImg.alt = 'Drink water';
        yogaImg.style.width = '250px';
        yogaImg.style.height = 'auto';
        yogaImg.style.borderRadius = '14px';
        yogaImg.style.boxShadow = '0 2px 12px rgba(31,38,135,0.10)';
        yogaImg.style.marginBottom = '1.2rem';
        yogaDiv.appendChild(yogaImg);
        // Complete button (only one, with unique class for Day 4)
        const completeYogaBtn = document.createElement('button');
        completeYogaBtn.textContent = 'I completed the task';
        completeYogaBtn.className = 'next-btn day4-complete-btn fixed-complete-btn';
        completeYogaBtn.style.background = '#4CAF50';
        completeYogaBtn.style.color = '#fff';
        // Remove marginTop so it matches previous button position
        completeYogaBtn.style.marginTop = '';
        yogaDiv.appendChild(completeYogaBtn);
        completeYogaBtn.onclick = function() {
            // Mark Day 4 as green (completed)
            const weekDays = document.querySelectorAll('.week-day-vertical .day-circle');
            if (weekDays.length > 3) {
                const day4 = weekDays[3];
                day4.innerHTML = tickSVG;
                day4.style.background = '#4CAF50';
                day4.style.borderColor = '#388E3C';
                day4.style.display = 'flex';
                day4.style.alignItems = 'center';
                day4.style.justifyContent = 'center';
                day4.style.padding = '0';
            }
            const day4Label = document.querySelectorAll('.week-day-vertical .day-label')[3];
            if (day4Label) {
                day4Label.style.color = '#388E3C';
                day4Label.style.fontWeight = '700';
            }
            yogaDiv.remove();
            h2.remove();
        // Show Day 5 Bubble Wrap Popping Game immediately after Day 4
        showDay5BubbleWrapTask();
// --- Day 5: Bubble Wrap Popping Game ---
function showDay5BubbleWrapTask() {
    const tasksContainer = document.querySelector('.tasks-container');
    tasksContainer.innerHTML = '';

    // 1. Title
    const h2 = document.createElement('h2');
    h2.textContent = 'Your Daily Task';
    tasksContainer.appendChild(h2);

    // 2. Subtitle
    const subtitle = document.createElement('div');
    subtitle.textContent = 'Self-Love Journal';
    subtitle.style.fontSize = '1.35rem';
    subtitle.style.fontWeight = '700';
    subtitle.style.color = '#f07264';
    subtitle.style.marginBottom = '0.5rem';
    subtitle.style.marginTop = '3rem';
    subtitle.style.letterSpacing = '0.5px';
    tasksContainer.appendChild(subtitle);

    // 2b. Description under subtitle
    const mandalaDesc = document.createElement('div');
    mandalaDesc.textContent = 'Take a quiet moment to reflect on who you are, not what youâ€™ve done. Write freely â€” no right or wrong answers.';
    mandalaDesc.style.fontSize = '1.08rem';
    mandalaDesc.style.marginTop = '1.5rem';
    mandalaDesc.style.color = '#444';
    mandalaDesc.style.marginBottom = '5rem';
    mandalaDesc.style.textAlign = 'center';
    tasksContainer.appendChild(mandalaDesc);
    // Add "Your Journal" link, centered and pink
    const journalLink = document.createElement('a');
    journalLink.href = "/self";
    journalLink.textContent = "Self-Love Journal";
    journalLink.style.display = "flex";
    journalLink.style.alignItems = "center";
    journalLink.style.justifyContent = "center";
    journalLink.style.width = "220px";
    journalLink.style.minWidth = "220px";
    journalLink.style.maxWidth = "220px";
    journalLink.style.height = "220px";
    journalLink.style.minHeight = "220px";
    journalLink.style.maxHeight = "220px";
    journalLink.style.aspectRatio = "1/1";
    journalLink.style.borderRadius = "50%";
    journalLink.style.background = "linear-gradient(135deg,#90EE90,#ADD8E6)";
    journalLink.style.color = "#fff";
    journalLink.style.fontSize = "1.25rem";
    journalLink.style.fontWeight = "700";
    journalLink.style.textDecoration = "none";
    journalLink.style.boxShadow = "0 4px 24px 0 rgba(240,114,100,0.13)";
    journalLink.style.margin = "0 auto 2.2rem auto";
    journalLink.style.transition = "background 0.2s,transform 0.1s";
    journalLink.style.textAlign = "center";
    tasksContainer.appendChild(journalLink);
    // 3. Game


    const gameDiv = document.createElement('div');
    gameDiv.style.position = 'relative';
    gameDiv.style.width = '100%';
    gameDiv.style.height = 'auto';
    gameDiv.style.margin = '2rem 0';
    gameDiv.style.background = '#fff';
    gameDiv.style.borderRadius = '22px';
    gameDiv.style.boxShadow = '0 4px 24px 0 rgba(74,144,226,0.09)';
    tasksContainer.appendChild(gameDiv);

    

    

    // Create bubble wrap grid
    

    // 4. Bubbles left text
    

    

    // 5. I completed the task button (match position to other buttons)
    const completeBtn = document.createElement('button');
    completeBtn.textContent = 'I completed the task';
    completeBtn.className = 'next-btn fixed-complete-btn';
    completeBtn.style.background = '#4CAF50';
    completeBtn.style.color = '#fff';
    completeBtn.onclick = function() {
        // Mark Day 5 as green (completed)
        const weekDays = document.querySelectorAll('.week-day-vertical .day-circle');
        if (weekDays.length > 4) {
            const day5 = weekDays[4];
            day5.innerHTML = tickSVG;
            day5.style.background = '#4CAF50';
            day5.style.borderColor = '#388E3C';
            day5.style.display = 'flex';
            day5.style.alignItems = 'center';
            day5.style.justifyContent = 'center';
            day5.style.padding = '0';
        }
        const day5Label = document.querySelectorAll('.week-day-vertical .day-label')[4];
        if (day5Label) {
            day5Label.style.color = '#388E3C';
            day5Label.style.fontWeight = '700';
        }
        // Remove all children from tasksContainer
        while (tasksContainer.firstChild) tasksContainer.removeChild(tasksContainer.firstChild);
        // Show Day 6 task
        showDay6MemoryTask();
    };
    tasksContainer.appendChild(completeBtn);

    // Mouse tracking for custom cursor
    gameDiv.addEventListener('mousemove', (e) => {
        const rect = gameDiv.getBoundingClientRect();
        cursor.style.left = (e.clientX - rect.left) + 'px';
        cursor.style.top = (e.clientY - rect.top) + 'px';
    });

    // Click handler
    canvas.addEventListener('click', (e) => {
        if (!gameActive) return;
        const rect = canvas.getBoundingClientRect();
        const mouseX = e.clientX - rect.left;
        const mouseY = e.clientY - rect.top;
        bubbles.forEach(bubble => {
            if (bubble.isClicked(mouseX, mouseY)) {
                bubble.pop();
            }
        });
    });

    // Touch support
    canvas.addEventListener('touchstart', (e) => {
        e.preventDefault();
        if (!gameActive) return;
        const rect = canvas.getBoundingClientRect();
        const touch = e.touches[0];
        const touchX = touch.clientX - rect.left;
        const touchY = touch.clientY - rect.top;
        bubbles.forEach(bubble => {
            if (bubble.isClicked(touchX, touchY)) {
                bubble.pop();
            }
        });
    });

    // Game loop
    function gameLoop() {
        ctx.fillStyle = '#ffffff';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = 'rgba(240,240,240,0.3)';
        for (let x = 0; x < canvas.width; x += 20) {
            ctx.fillRect(x, 0, 1, canvas.height);
        }
        for (let y = 0; y < canvas.height; y += 20) {
            ctx.fillRect(0, y, canvas.width, 1);
        }
        bubbles.forEach(bubble => {
            bubble.draw();
        });
        requestAnimationFrame(gameLoop);
    }

    // Start the game
    createBubbleWrap();
    gameLoop();
}
// --- End Day 5 ---
        };
        // Insert into main content
        h2.insertAdjacentElement('afterend', yogaDiv);
    }
    // --- End Day 4 ---
    // --- Day 5: Breathe with the Circle ---
    function showDay5BreathingTask() {
        const mainContent = document.querySelector('.main-tasks-content');
        if (!mainContent) return;
        // Remove any previous breathing section or h2 in mainContent
        const oldBreathing = mainContent.querySelectorAll('.breathing-section');
        oldBreathing.forEach(el => el.remove());
        const oldH2 = mainContent.querySelector('h2');
        if (oldH2) oldH2.remove();
    // Day 5 breathing task is skipped; do nothing
    return;
    }
    // --- End Day 5 ---
    // --- Day 5: Burst the Bubbles ---
    function showDay5BubbleTask() {
        const tasksContainer = document.querySelector('.tasks-container');
        tasksContainer.innerHTML = '';
        // Title
        const h2 = document.createElement('h2');
        h2.textContent = 'Your Daily Task';
        tasksContainer.appendChild(h2);
        // Subtitle styled like a title, but smaller
        const subtitle = document.createElement('div');
        subtitle.textContent = 'Burst the Bubbles';
        subtitle.style.fontSize = '1.35rem';
        subtitle.style.fontWeight = '700';
        subtitle.style.color = '#f07264';
        subtitle.style.marginBottom = '0.5rem';
        subtitle.style.letterSpacing = '0.5px';
        tasksContainer.appendChild(subtitle);
        // Description
        const desc = document.createElement('div');
        desc.className = 'task-desc';
        desc.innerHTML = `<p>The screen is filled with soft, floating bubbles that drift gracefully in different directions. You're given a movable armâ€”controlled by your mouse, touch, or keyboardâ€”that can be rotated and extended to reach out and pop the bubbles.<br><br>`;
        tasksContainer.appendChild(desc);
        // Game container
        const gameDiv = document.createElement('div');
        gameDiv.style.display = 'flex';
        gameDiv.style.justifyContent = 'center';
        gameDiv.style.alignItems = 'center';
        gameDiv.style.margin = '2rem 0';
        // Canvas (make a bit smaller)
        const canvas = document.createElement('canvas');
        canvas.width = 420;
        canvas.height = 320;
        canvas.style.background = 'linear-gradient(180deg,#eaf6fb 60%,#f7e7e1 100%)';
        canvas.style.borderRadius = '22px';
        canvas.style.boxShadow = '0 4px 24px 0 rgba(74,144,226,0.09)';
        gameDiv.appendChild(canvas);
        tasksContainer.appendChild(gameDiv);
        // Pop sound
        let popAudio = document.createElement('audio');
        popAudio.src = '/static/music/forest.wav'; // Use a gentle sound you have, or replace with a pop sound
        // Bubble/arm logic
        const ctx = canvas.getContext('2d');
        // Fill the square with more bubbles, avoiding overlap
        const BUBBLE_COUNT = 20;
        let bubbles = [];
        function randomBubble() {
            let r = 20 + Math.random() * 12;
            let x = r + Math.random() * (canvas.width - 2*r);
            let y = r + Math.random() * (canvas.height - 2*r);
            let dx = (Math.random() - 0.5) * 0.7;
            let dy = (Math.random() - 0.5) * 0.7;
            let color = `rgba(${180+Math.floor(Math.random()*60)},${210+Math.floor(Math.random()*30)},${240+Math.floor(Math.random()*15)},0.7)`;
            return {x, y, r, dx, dy, color, popped: false, popAnim: 0};
        }
        function placeBubbleNoOverlap(maxTries=100) {
            for (let tries=0; tries<maxTries; tries++) {
                let b = randomBubble();
                let overlap = false;
                for (let other of bubbles) {
                    if (other.popped) continue;
                    let dist = Math.hypot(b.x - other.x, b.y - other.y);
                    if (dist < b.r + other.r + 6) { overlap = true; break; }
                }
                if (!overlap) return b;
            }
            return null;
        }
        // Initial fill
        let attempts = 0;
        while (bubbles.length < BUBBLE_COUNT && attempts < 1000) {
            let b = placeBubbleNoOverlap();
            if (b) bubbles.push(b);
            attempts++;
        }
        // Arm state
        let arm = {
            baseX: canvas.width/2,
            baseY: canvas.height-40,
            angle: -Math.PI/2,
            length: 120,
            minLength: 60,
            maxLength: 180,
            rotating: 0,
            extending: 0
        };
        // Controls
        document.onkeydown = function(e) {
            if (e.key === 'ArrowLeft') arm.rotating = -1;
            if (e.key === 'ArrowRight') arm.rotating = 1;
            if (e.key === 'ArrowUp') arm.extending = 1;
            if (e.key === 'ArrowDown') arm.extending = -1;
        };
        document.onkeyup = function(e) {
            if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') arm.rotating = 0;
            if (e.key === 'ArrowUp' || e.key === 'ArrowDown') arm.extending = 0;
        };
        // Mouse/touch drag
        let dragging = false;
        canvas.addEventListener('mousedown', e => { dragging = true; moveArmTo(e); });
        canvas.addEventListener('mousemove', e => { if (dragging) moveArmTo(e); });
        canvas.addEventListener('mouseup', () => { dragging = false; });
        canvas.addEventListener('mouseleave', () => { dragging = false; });
        canvas.addEventListener('touchstart', e => { dragging = true; moveArmTo(e.touches[0]); });
        canvas.addEventListener('touchmove', e => { if (dragging) moveArmTo(e.touches[0]); });
        canvas.addEventListener('touchend', () => { dragging = false; });
        function moveArmTo(e) {
            let rect = canvas.getBoundingClientRect();
            let mx = e.clientX - rect.left;
            let my = e.clientY - rect.top;
            let dx = mx - arm.baseX;
            let dy = my - arm.baseY;
            arm.angle = Math.atan2(dy, dx);
            arm.length = Math.max(arm.minLength, Math.min(arm.maxLength, Math.sqrt(dx*dx+dy*dy)));
        }
        // Animation
        function draw() {
            ctx.clearRect(0,0,canvas.width,canvas.height);
            // Draw bubbles
            for (let b of bubbles) {
                if (b.popped && b.popAnim >= 1) continue;
                if (b.popped) {
                    b.popAnim += 0.08;
                    ctx.save();
                    ctx.globalAlpha = 1-b.popAnim;
                    ctx.beginPath();
                    ctx.arc(b.x, b.y, b.r + 18*b.popAnim, 0, 2*Math.PI);
                    ctx.fillStyle = '#fff';
                    ctx.fill();
                    ctx.beginPath();
                    ctx.arc(b.x, b.y, b.r + 8*b.popAnim, 0, 2*Math.PI);
                    ctx.strokeStyle = '#aee1f9';
                    ctx.lineWidth = 2+6*(1-b.popAnim);
                    ctx.stroke();
                    ctx.restore();
                    // When popAnim is done, replace with a new bubble
                    if (b.popAnim >= 1) {
                        let idx = bubbles.indexOf(b);
                        if (idx !== -1) {
                            let newB = placeBubbleNoOverlap();
                            if (newB) {
                                bubbles[idx] = newB;
                            } else {
                                bubbles[idx] = randomBubble();
                            }
                        }
                    }
                    continue;
                }
                // Bubble body
                ctx.save();
                ctx.beginPath();
                ctx.arc(b.x, b.y, b.r, 0, 2*Math.PI);
                ctx.fillStyle = b.color;
                ctx.shadowColor = '#aee1f9';
                ctx.shadowBlur = 16;
                ctx.fill();
                ctx.shadowBlur = 0;
                // Bubble highlight
                ctx.beginPath();
                ctx.arc(b.x-b.r/3, b.y-b.r/3, b.r/3, 0, 2*Math.PI);
                ctx.globalAlpha = 0.18;
                ctx.fillStyle = '#fff';
                ctx.fill();
                ctx.globalAlpha = 1.0;
                ctx.restore();
            }
            // Draw arm
            ctx.save();
            ctx.strokeStyle = '#f07264';
            ctx.lineWidth = 10;
            ctx.lineCap = 'round';
            ctx.shadowColor = '#f07264';
            ctx.shadowBlur = 8;
            ctx.beginPath();
            ctx.moveTo(arm.baseX, arm.baseY);
            let tipX = arm.baseX + Math.cos(arm.angle)*arm.length;
            let tipY = arm.baseY + Math.sin(arm.angle)*arm.length;
            ctx.lineTo(tipX, tipY);
            ctx.stroke();
            ctx.shadowBlur = 0;
            // Arm tip
            ctx.beginPath();
            ctx.arc(tipX, tipY, 13, 0, 2*Math.PI);
            ctx.fillStyle = '#E2BDA7';
            ctx.globalAlpha = 0.95;
            ctx.fill();
            ctx.globalAlpha = 1.0;
            ctx.lineWidth = 3;
            ctx.strokeStyle = '#f07264';
            ctx.stroke();
            ctx.restore();
            // Animate arm
            if (arm.rotating) arm.angle += 0.045 * arm.rotating;
            if (arm.extending) arm.length += 3 * arm.extending;
            arm.length = Math.max(arm.minLength, Math.min(arm.maxLength, arm.length));
            // Move bubbles
            for (let b of bubbles) {
                if (b.popped) continue;
                b.x += b.dx;
                b.y += b.dy;
                // Bounce off walls
                if (b.x-b.r < 0 && b.dx < 0) b.dx *= -1;
                if (b.x+b.r > canvas.width && b.dx > 0) b.dx *= -1;
                if (b.y-b.r < 0 && b.dy < 0) b.dy *= -1;
                if (b.y+b.r > canvas.height && b.dy > 0) b.dy *= -1;
            }
            // Check for pops
            for (let b of bubbles) {
                if (b.popped) continue;
                let dist = Math.hypot(b.x-tipX, b.y-tipY);
                if (dist < b.r+13) {
                    b.popped = true;
                    b.popAnim = 0;
                    popAudio.currentTime = 0;
                    popAudio.play();
                }
            }
            // Never ends: no win check
            requestAnimationFrame(draw);
        }
        draw();

        // Add "I completed the task" button
        const completeBtn = document.createElement('button');
        completeBtn.id = 'complete-task-btn';
        completeBtn.className = 'next-btn fixed-complete-btn';
        completeBtn.style.background = '#4CAF50';
        completeBtn.style.color = '#fff';
        completeBtn.textContent = 'I completed the task';
        tasksContainer.appendChild(completeBtn);
        completeBtn.onclick = function() {
            // Mark Day 5 as green (completed)
            const weekDays = document.querySelectorAll('.week-day-vertical .day-circle');
            if (weekDays.length > 4) {
                const day5 = weekDays[4];
                day5.innerHTML = tickSVG;
                day5.style.background = '#4CAF50';
                day5.style.borderColor = '#388E3C';
                day5.style.display = 'flex';
                day5.style.alignItems = 'center';
                day5.style.justifyContent = 'center';
                day5.style.padding = '0';
            }
            const day5Label = document.querySelectorAll('.week-day-vertical .day-label')[4];
            if (day5Label) {
                day5Label.style.color = '#388E3C';
                day5Label.style.fontWeight = '700';
            }
            // Remove all children from tasksContainer (title, subtitle, desc, game, button)
            while (tasksContainer.firstChild) tasksContainer.removeChild(tasksContainer.firstChild);
            // Show Day 6 task
            showDay6MemoryTask();
        };
    }
    // --- End Day 5 ---

    // --- Day 6: Memory Game ---
    function showDay6MemoryTask() {
        const tasksContainer = document.querySelector('.tasks-container');
        tasksContainer.innerHTML = '';
        // Title
        const h2 = document.createElement('h2');
        h2.textContent = 'Your Daily Task';
        tasksContainer.appendChild(h2);
        // Subtitle
        const subtitle = document.createElement('div');
        subtitle.textContent = 'Mantra Practice for Panic Attacks';
        subtitle.style.fontSize = '1.35rem';
        subtitle.style.fontWeight = '700';
        subtitle.style.color = '#f07264';
        subtitle.style.marginBottom = '0.5rem';
        subtitle.style.letterSpacing = '0.5px';
        tasksContainer.appendChild(subtitle);
        // Description
        const desc = document.createElement('div');
        desc.className = 'task-desc';
        desc.innerHTML = `
  <ul style="text-align: left; line-height: 1.6; margin-top: 1rem;">
    ðŸ—£ï¸ <span>Repeat a calming mantra:</span> <br>â€œThis too will pass.â€ It helps ground you and shift your focus away from fear.<br><br>
    â±ï¸ <span>Panic attacks peak in about 10 minutes:</span> Remind yourself the intensity wonâ€™t last forever.<br><br>
    ðŸ“‰ <span>Symptoms will gradually ease:</span> After the peak, most symptoms begin to fade on their own.<br><br>
    ðŸ§  <span>Mantras calm the nervous system:</span> Repetition can reduce racing thoughts and bring emotional control.<br><br>
    ðŸŒ¬ï¸ <span>Combine with slow breathing:</span> Inhale deeply, repeat the mantra silently or out loud, and exhale slowly.<br><br>
    ðŸ™Œ <span>Be kind to yourself:</span> Acknowledge your feelings, but remind yourself: <em>You are safe. It will pass.</em><br><br>   
  </ul>`;
        tasksContainer.appendChild(desc);

        

        // Always show the complete button at the bottom (like other days)
        const completeBtn = document.createElement('button');
        completeBtn.textContent = 'I completed the task';
        completeBtn.className = 'next-btn fixed-complete-btn';
        completeBtn.style.background = '#4CAF50';
        completeBtn.style.color = '#fff';
        completeBtn.onclick = function() {
            // Mark Day 6 as green (completed)
            const weekDays = document.querySelectorAll('.week-day-vertical .day-circle');
            if (weekDays.length > 5) {
                const day6 = weekDays[5];
                day6.innerHTML = tickSVG;
                day6.style.background = '#4CAF50';
                day6.style.borderColor = '#388E3C';
                day6.style.display = 'flex';
                day6.style.alignItems = 'center';
                day6.style.justifyContent = 'center';
                day6.style.padding = '0';
            }
            const day6Label = document.querySelectorAll('.week-day-vertical .day-label')[5];
            if (day6Label) {
                day6Label.style.color = '#388E3C';
                day6Label.style.fontWeight = '700';
            }
            // Remove all children from tasksContainer
            while (tasksContainer.firstChild) tasksContainer.removeChild(tasksContainer.firstChild);
            // Show Day 7 task IMMEDIATELY and ensure rendering
            setTimeout(function() {
                showDay7PuzzleTask();
            }, 0);
        };
        tasksContainer.appendChild(completeBtn);

        // Create icon cards (hidden before start)
        let cardEls = [];
        for (let i = 0; i < 9; i++) {
            const card = document.createElement('div');
            card.style.width = '78px';
            card.style.height = '78px';
            card.style.background = '#f7e7e1';
            card.style.borderRadius = '18px';
            card.style.display = 'flex';
            card.style.alignItems = 'center';
            card.style.justifyContent = 'center';
            card.style.fontSize = '2.2rem';
            card.style.boxShadow = '0 2px 8px rgba(74,144,226,0.10)';
            card.style.cursor = 'pointer';
            card.style.transition = 'background 0.3s, color 0.3s';
            card.dataset.idx = i;
            card.textContent = '';
            board.appendChild(card);
            cardEls.push(card);
        }

        // Timer
        const timerDiv = document.createElement('div');
        timerDiv.style.fontSize = '1.1rem';
        timerDiv.style.color = '#4A90E2';
        timerDiv.style.marginBottom = '1.2rem';
        timerDiv.textContent = '';
        tasksContainer.appendChild(timerDiv);

        // Start button
        const startBtn = document.createElement('button');
        startBtn.textContent = 'Start';
        startBtn.style.background = '#4A90E2';
        startBtn.style.color = '#fff';
        startBtn.style.fontSize = '1rem';
        startBtn.style.fontWeight = '600';
        startBtn.style.border = 'none';
        startBtn.style.borderRadius = '12px';
        startBtn.style.padding = '0.4rem 1.2rem';
        startBtn.style.marginBottom = '1.2rem';
        startBtn.style.cursor = 'pointer';
        startBtn.style.transition = 'background 0.2s';
        startBtn.style.boxShadow = '0 2px 8px rgba(74,144,226,0.10)';
        tasksContainer.appendChild(startBtn);

        // Hide cards and timer until start
        board.style.opacity = '1';
        for (let i = 0; i < 9; i++) {
            cardEls[i].style.pointerEvents = 'none';
            cardEls[i].textContent = '';
        }

        let timeLeft = 15;
        let timerId = null;

        startBtn.onclick = function() {
            startBtn.disabled = true;
            startBtn.style.opacity = '0.6';
            board.style.opacity = '1';
            // Reveal icons
            for (let i = 0; i < 9; i++) {
                cardEls[i].textContent = iconOrder[i];
                cardEls[i].style.pointerEvents = '';
            }
            timerDiv.textContent = `Time left: ${timeLeft}s`;
            timerId = setInterval(() => {
                timeLeft--;
                timerDiv.textContent = `Time left: ${timeLeft}s`;
                if (timeLeft <= 0) {
                    clearInterval(timerId);
                    hideCards();
                }
            }, 1000);
        };

        // Hide cards after 60 seconds
        function hideCards() {
            revealed = false;
            timerDiv.textContent = '';
            for (let i = 0; i < 9; i++) {
                cardEls[i].textContent = (i+1).toString();
                cardEls[i].style.background = '#E2BDA7';
                cardEls[i].style.color = '#fff';
                cardEls[i].style.fontWeight = '700';
                cardEls[i].style.fontSize = '1.3rem';
                cardEls[i].style.pointerEvents = '';
            }
            // Start recall phase after a short delay
            setTimeout(startRecall, 800);
        }

        // Start recall phase
        function startRecall() {
            // Shuffle recall order
            let recallOrder = icons.slice();
            for (let i = recallOrder.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [recallOrder[i], recallOrder[j]] = [recallOrder[j], recallOrder[i]];
            }
            currentQuery = 0;
            guesses = [];
            score = 0;
            askNext(recallOrder);
        }

        // Ask user to find the location of the next icon
        function askNext(recallOrder) {
            // Remove any previous query
            let oldQuery = document.getElementById('memory-query');
            if (oldQuery) oldQuery.remove();
            // Remove any previous result
            let oldResult = document.getElementById('memory-result');
            if (oldResult) oldResult.remove();
            // Show query
            if (currentQuery < recallOrder.length) {
                const queryDiv = document.createElement('div');
                queryDiv.id = 'memory-query';
                queryDiv.style.fontSize = '1.15rem';
                queryDiv.style.color = '#4A90E2';
                queryDiv.style.margin = '1.2rem 0 0.7rem 0';
                queryDiv.innerHTML = `Where was <span style=\"font-size:2.8rem;\">${recallOrder[currentQuery]}</span>? Click the correct card.`;
                tasksContainer.appendChild(queryDiv);
                // Enable card clicks
                for (let i = 0; i < 9; i++) {
                    cardEls[i].onclick = function() {
                        if (!revealed && !matched[i]) {
                            // Check answer
                            let correct = (iconOrder[i] === recallOrder[currentQuery]);
                            guesses.push({guess: i, correct: correct});
                            matched[i] = true;
                            if (correct) {
                                cardEls[i].style.background = '#4CAF50';
                                cardEls[i].style.color = '#fff';
                                score++;
                            } else {
                                cardEls[i].style.background = '#f07264';
                                cardEls[i].style.color = '#fff';
                                // Also highlight the correct card
                                for (let j = 0; j < 9; j++) {
                                    if (iconOrder[j] === recallOrder[currentQuery]) {
                                        cardEls[j].style.background = '#4CAF50';
                                        cardEls[j].style.color = '#fff';
                                    }
                                }
                            }
                            // Disable all cards for this round
                            for (let k = 0; k < 9; k++) cardEls[k].onclick = null;
                            setTimeout(() => {
                                currentQuery++;
                                askNext(recallOrder);
                            }, 900);
                        }
                    };
                }
            } else {
                // Game over, show score and show wait message only
                // Instead of clearing the board, show the Retry button and score in place of the Start button, keeping the board visible
                // Hide the Start button if present
                if (startBtn) {
                    startBtn.style.display = 'none';
                }
                // Remove any previous retry or score
                let oldRetry = tasksContainer.querySelector('.memory-retry-btn');
                if (oldRetry) oldRetry.remove();
                let oldScore = tasksContainer.querySelector('.memory-score-div');
                if (oldScore) oldScore.remove();
                // Insert Retry button after Start button, using a unique variable name to avoid redeclaration
                const memoryRetryBtn = document.createElement('button');
                memoryRetryBtn.textContent = 'Retry';
                memoryRetryBtn.className = 'memory-retry-btn';
                memoryRetryBtn.style.background = '#f07264';
                memoryRetryBtn.style.color = '#fff';
                memoryRetryBtn.style.fontSize = '1rem';
                memoryRetryBtn.style.fontWeight = '600';
                memoryRetryBtn.style.border = 'none';
                memoryRetryBtn.style.borderRadius = '12px';
                memoryRetryBtn.style.padding = '0.4rem 1.2rem';
                memoryRetryBtn.style.marginBottom = '0.7rem';
                memoryRetryBtn.style.cursor = 'pointer';
                memoryRetryBtn.style.transition = 'background 0.2s';
                memoryRetryBtn.style.boxShadow = '0 2px 8px rgba(240,114,100,0.10)';
                // Insert after Start button
                if (startBtn && startBtn.parentNode) {
                    startBtn.parentNode.insertBefore(memoryRetryBtn, startBtn.nextSibling);
                } else {
                    tasksContainer.appendChild(memoryRetryBtn);
                }
                memoryRetryBtn.onclick = function() {
                    showDay6MemoryTask();
                };
                // Insert score below Retry button
                const scoreDiv = document.createElement('div');
                scoreDiv.className = 'memory-score-div';
                scoreDiv.style.fontSize = '1.35rem';
                scoreDiv.style.fontWeight = '700';
                scoreDiv.style.color = '#4A90E2';
                scoreDiv.style.margin = '0.7rem 0 1.2rem 0';
                scoreDiv.textContent = `Your score: ${score} / 9`;
                memoryRetryBtn.insertAdjacentElement('afterend', scoreDiv);
// --- Day 7: Mind Unwind â€“ Simple Puzzle Game ---
function showDay7PuzzleTask() {
    const tasksContainer = document.querySelector('.tasks-container');
    tasksContainer.innerHTML = '';
    // Title
    const h2 = document.createElement('h2');
    h2.textContent = 'Your Daily Task';
    tasksContainer.appendChild(h2);
    // Subtitle styled like a title, but smaller
    const subtitle = document.createElement('div');
    subtitle.textContent = '5 4 3 2 1 â€“ Grounding Technique';
    subtitle.style.fontSize = '1.35rem';
    subtitle.style.fontWeight = '700';
    subtitle.style.color = '#f07264';
    subtitle.style.marginBottom = '0.5rem';
    subtitle.style.letterSpacing = '0.5px';
    tasksContainer.appendChild(subtitle);
    // Description (with goal and mental break info)
    const desc = document.createElement('div');
    desc.className = 'task-desc';
    desc.innerHTML = `<p>Challenge your mind gently with this relaxing puzzle. Rearrange the pieces to complete the picture or pattern.<br><br>Take your timeâ€”thereâ€™s no timer, no pressure. Just a quiet space to focus, think, and enjoy the satisfaction of solving.</p><ul style='margin:0 0 0.7rem 1.2rem;padding:0;font-size:1.08rem;'>`;
    tasksContainer.appendChild(desc);

    

    // Show complete button only when solved
    let completeBtn = null;
    function showCompleteBtn() {
        if (completeBtn) return;
        completeBtn = document.createElement('button');
        completeBtn.id = 'complete-task-btn';
        completeBtn.className = 'next-btn fixed-complete-btn';
        completeBtn.style.background = '#4CAF50';
        completeBtn.style.color = '#fff';
        completeBtn.textContent = 'I completed the task';
        tasksContainer.appendChild(completeBtn);
        completeBtn.onclick = function() {
            // Mark Day 7 as green (completed)
            const weekDays = document.querySelectorAll('.week-day-vertical .day-circle');
            if (weekDays.length > 6) {
                const day7 = weekDays[6];
                day7.innerHTML = tickSVG;
                day7.style.background = '#4CAF50';
                day7.style.borderColor = '#388E3C';
                day7.style.display = 'flex';
                day7.style.alignItems = 'center';
                day7.style.justifyContent = 'center';
                day7.style.padding = '0';
            }
            const day7Label = document.querySelectorAll('.week-day-vertical .day-label')[6];
            if (day7Label) {
                day7Label.style.color = '#388E3C';
                day7Label.style.fontWeight = '700';
            }
            // Remove all children from tasksContainer
            while (tasksContainer.firstChild) tasksContainer.removeChild(tasksContainer.firstChild);
            // Optionally show a congrats message or next steps here
        };
    }

    renderPuzzle();
}
// --- End Day 7 ---

                // (removed duplicate Retry button code)
            }
        }
    } // --- End Day 6 ---
    </script>
</body>
</html>