<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Tasks - Mental Health Assistant</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        body {
            background: url('/static/images/cover.jpg') no-repeat center center fixed;
            background-size: cover;
        }
        .tasks-container {
            max-width: 500px;
            margin-left: 200px;
            background: rgba(255,255,255,0.93);
            border-radius: 32px;
            box-shadow: 0 2px 18px rgba(0,0,0,0.13);
            padding: 2.5rem 2.5rem 2rem 2.5rem;
            text-align: center;
            align-items: flex-start;
        }
        .tasks-container h2 {
            color: #E2BDA7;
            margin-bottom: 1.5rem;
            font-size: 2rem;
            font-weight: 700;
            letter-spacing: 1px;
        }
        .back-link {
            color: #E2BDA7;
            font-weight: 500;
            text-decoration: underline;
            margin-top: 1.5rem;
            display: inline-block;
            font-size: 1.08rem;
        }
        .back-link:hover {
            color: #d1a98a;
        }
        .breathing-section {
            margin: 0 auto;
            max-width: 400px;
            display: flex;
            flex-direction: column;
            align-items: center;
            background: none !important;
            border-radius: 0;
            padding: 0;
            box-shadow: none !important;
        }
        .breathing-title {
            font-size: 1.35rem;
            font-weight: 700;
            color: #f07264;
            margin-bottom: 0.5rem;
            letter-spacing: 0.5px;
        }
        .breathing-desc {
            font-size: 1.08rem;
            color: #444;
            margin-bottom: 1.2rem;
            text-align: center;
        }
        .breathing-game {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 1.2rem;
        }
        #breathing-circle {
            background: transparent;
            margin-bottom: 1.1rem;
            border-radius: 50%;
            box-shadow: 0 4px 24px 0 rgba(240,114,100,0.13);
            transition: box-shadow 0.3s;
        }
        .breathing-instruction {
            font-size: 1.25rem;
            font-weight: 600;
            color: #f07264;
            letter-spacing: 1px;
            min-height: 1.5em;
            margin-bottom: 0.5rem;
            text-shadow: 0 1px 8px #f07264, 0 1px 2px #fff;
            transition: color 0.3s;
        }
        .next-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 1.5rem;
        }
        .next-label {
            font-size: 1.08rem;
            color: #f07264;
            font-weight: 500;
            margin-bottom: 0.7rem;
            letter-spacing: 0.5px;
        }
        .next-btn {
            margin-top: 1.5rem;
            background: linear-gradient(90deg, #f07264 60%, #E2BDA7 100%);
            color: #fff;
            font-size: 1.13rem;
            font-weight: 600;
            border: none;
            border-radius: 18px;
            padding: 0.7rem 2.2rem;
            box-shadow: 0 2px 8px rgba(240,114,100,0.10);
            cursor: pointer;
            transition: background 0.2s, transform 0.1s;
            letter-spacing: 1px;
        }
        .next-btn:hover {
            background: linear-gradient(90deg, #E2BDA7 10%, #f07264 100%);
            color: #f07264;
            transform: translateY(-2px) scale(1.04);
        }
        .task-result {
            margin-top: 1.2rem;
            font-size: 1.12rem;
            color: #333;
            text-align: center;
            font-weight: 500;
            min-height: 2.2em;
        }
        .daily-tasks-page-layout {
            display: flex;
            flex-direction: row;
            align-items: flex-start;
            justify-content: center;
            gap: 3.5rem;
            margin-top: 2.2rem;
        }
        .week-progress-vertical {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 120px;
            margin-top: 0.5rem;
            background: none;
        }
        .week-title {
            font-size: 1.13rem;
            font-weight: 700;
            color: #f07264;
            margin-bottom: 1.1rem;
            letter-spacing: 0.5px;
        }
        .week-days-vertical {
            display: flex;
            flex-direction: column;
            gap: 1.1rem;
            align-items: center;
        }
        .week-day-vertical {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.3rem;
        }
        .day-circle {
            width: 44px;
            height: 44px;
            background: #f07264;
            color: #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            font-weight: 700;
            box-shadow: 0 2px 8px rgba(240,114,100,0.13);
            margin-bottom: 0.2rem;
            border: 3px solid #f7c6b7;
        }
        .day-label {
            font-size: 1.01rem;
            color: #f07264;
            font-weight: 500;
            letter-spacing: 0.5px;
        }
        .main-tasks-content {
            flex: 1;
            min-width: 320px;
            max-width: 500px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <span class="navbar-title">Mental Health Assistant</span>
        <div class="navbar-left">
            <div class="navbar-center">
                <a href="/" class="navbar-link">Assistant</a>
                <a href="/daily_tasks" class="navbar-link active">Daily Tasks</a>
            </div>
        </div>
        <div class="navbar-right">
            <span class="navbar-user">Welcome, {{ current_user.username }}</span>
            <a href="/logout" class="navbar-link">Logout</a>
        </div>
    </nav>
    <div class="daily-tasks-page-layout" style="gap: 0; justify-content: flex-start;">
        <aside class="week-progress-vertical" style="margin-top: 3rem; margin-left: 7rem; align-items: flex-start;">
            <div class="week-days-vertical" style="align-items: flex-start; gap: 2.1rem;">
                <div class="week-title">Complete the tasks for 7 days and you <br>should come back to the Assistant.</div>
                <div class="week-day-vertical" style="flex-direction: row; gap: 0.7rem; align-items: flex-start;"><span class="day-circle">1</span><span class="day-label"><b>Day 1</b><br> Breathe with the Circle </span></div>
                <div class="week-day-vertical" style="flex-direction: row; gap: 0.7rem; align-items: flex-start;"><span class="day-circle">2</span><span class="day-label"><b>Day 2</b><br> Breathe with the Circle </span></div>
                <div class="week-day-vertical" style="flex-direction: row; gap: 0.7rem; align-items: flex-start;"><span class="day-circle">3</span><span class="day-label"><b>Day 3</b><br> Breathe with the Circle </span></div>
                <div class="week-day-vertical" style="flex-direction: row; gap: 0.7rem; align-items: flex-start;"><span class="day-circle">4</span><span class="day-label"><b>Day 4</b><br> Breathe with the Circle </span></div>
                <div class="week-day-vertical" style="flex-direction: row; gap: 0.7rem; align-items: flex-start;"><span class="day-circle">5</span><span class="day-label"><b>Day 5</b><br> Breathe with the Circle </span></div>
                <div class="week-day-vertical" style="flex-direction: row; gap: 0.7rem; align-items: flex-start;"><span class="day-circle">6</span><span class="day-label"><b>Day 6</b><br> Breathe with the Circle </span></div>
                <div class="week-day-vertical" style="flex-direction: row; gap: 0.7rem; align-items: flex-start;"><span class="day-circle">7</span><span class="day-label"><b>Day 7</b><br> Breathe with the Circle </span></div>
            </div>
        </aside>
        <div class="tasks-container">
            <h2>Your Daily Task</h2>
            <h3 id="task-subtitle" style="color:#f07264; font-size:1.18rem; font-weight:600; margin-bottom:1.2rem; letter-spacing:0.5px;">Take a 5-minute mindful breathing break</h3>
            <main class="main-tasks-content">
                <div class="breathing-section" style="background:none;box-shadow:none;padding:0;">
                    <div class="breathing-title">Breathe with the Circle</div>
                    <div class="breathing-desc">Follow the animation below. Inhale as the circle expands, hold, exhale as it contracts, hold. Try to sync your breath for a few cycles to relax and focus.</div>
                    <div id="breathing-game" class="breathing-game">
                        <canvas id="breathing-circle" width="260" height="260"></canvas>
                        <div id="breathing-instruction" class="breathing-instruction">Inhale</div>
                    </div>
                </div>
                <button id="complete-task-btn" class="next-btn" style="margin-top:2rem; background:#4CAF50; color:#fff;">I completed the task</button>
                <div class="next-section" style="display:none;"></div>
                <div id="task-result" class="task-result"></div>
            </main>
        </div>
    </div>
    <script>
    // Animated Breathing Circle Game
    const canvas = document.getElementById('breathing-circle');
    const ctx = canvas.getContext('2d');
    const instruction = document.getElementById('breathing-instruction');
    let phase = 0; // 0: inhale, 1: hold, 2: exhale, 3: hold
    let t = 0;
    const phases = [
        { label: 'Inhale', color: '#E2BDA7', duration: 4000, shadow: '#f07264' },
        { label: 'Hold', color: '#f7c6b7', duration: 2000, shadow: '#f07264' },
        { label: 'Exhale', color: '#f07264', duration: 4000, shadow: '#f07264' },
        { label: 'Hold', color: '#f7c6b7', duration: 2000, shadow: '#f07264' }
    ];
    let start = null;
    function animateBreath(ts) {
        if (!start) start = ts;
        let elapsed = ts - start;
        let p = phases[phase];
        let progress = Math.min(elapsed / p.duration, 1);
        // Circle radius: 60 (min) to 120 (max)
        let radius;
        if (phase === 0) radius = 60 + 60 * easeInOut(progress); // Inhale
        else if (phase === 1) radius = 120; // Hold (full)
        else if (phase === 2) radius = 120 - 60 * easeInOut(progress); // Exhale
        else radius = 60; // Hold (empty)
        // Animate background glow
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.save();
        ctx.beginPath();
        ctx.arc(130, 130, radius + 12, 0, 2 * Math.PI);
        ctx.globalAlpha = 0.18;
        ctx.fillStyle = p.shadow;
        ctx.filter = 'blur(10px)';
        ctx.fill();
        ctx.restore();
        // Main circle
        ctx.beginPath();
        ctx.arc(130, 130, radius, 0, 2 * Math.PI);
        ctx.fillStyle = p.color;
        ctx.globalAlpha = 0.82;
        ctx.filter = 'none';
        ctx.fill();
        ctx.globalAlpha = 1.0;
        ctx.lineWidth = 5;
        ctx.strokeStyle = '#f07264';
        ctx.shadowColor = p.shadow;
        ctx.shadowBlur = 16;
        ctx.stroke();
        ctx.shadowBlur = 0;
        // Breathing dots
        for (let i = 0; i < 8; i++) {
            let angle = (i / 8) * 2 * Math.PI;
            let dotR = radius + 18 + 6 * Math.sin(ts/400 + i);
            ctx.beginPath();
            ctx.arc(130 + dotR * Math.cos(angle), 130 + dotR * Math.sin(angle), 4, 0, 2 * Math.PI);
            ctx.fillStyle = '#fff';
            ctx.globalAlpha = 0.7;
            ctx.fill();
        }
        ctx.globalAlpha = 1.0;
        instruction.textContent = p.label;
        instruction.style.color = '#f07264';
        if (elapsed < p.duration) {
            requestAnimationFrame(animateBreath);
        } else {
            phase = (phase + 1) % phases.length;
            start = null;
            requestAnimationFrame(animateBreath);
        }
    }
    function easeInOut(x) {
        return x < 0.5 ? 2 * x * x : 1 - Math.pow(-2 * x + 2, 2) / 2;
    }
    if (canvas && ctx && instruction) {
        requestAnimationFrame(animateBreath);
    }
    // Add tick SVG for completed day
    const tickSVG = '<svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="11" cy="11" r="11" fill="#4CAF50"/><path d="M6 12.5L10 16L16 8" stroke="#fff" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"/></svg>';
    document.addEventListener('DOMContentLoaded', function() {
        const completeBtn = document.getElementById('complete-task-btn');
        if (completeBtn) {
            completeBtn.onclick = function() {
                // Find Day 1 circle (first .day-circle in .week-day-vertical)
                const weekDays = document.querySelectorAll('.week-day-vertical .day-circle');
                if (weekDays.length > 0) {
                    const day1 = weekDays[0];
                    day1.innerHTML = tickSVG;
                    day1.style.background = '#4CAF50';
                    day1.style.borderColor = '#388E3C';
                    day1.style.display = 'flex';
                    day1.style.alignItems = 'center';
                    day1.style.justifyContent = 'center';
                    day1.style.padding = '0';
                }
                // Make Day 1 title and subtitle green
                const day1Label = document.querySelectorAll('.week-day-vertical .day-label')[0];
                if (day1Label) {
                    day1Label.style.color = '#388E3C';
                    day1Label.style.fontWeight = '700';
                }
            };
        }
    });
    </script>
</body>
</html>